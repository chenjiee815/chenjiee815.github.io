<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Chen Jie" />
        <meta name="copyright" content="Chen Jie" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, stdlibs, Python, " />

<meta property="og:title" content="CGIHTTPServer标准库源码学习 "/>
<meta property="og:url" content="http://chenjiee815.github.io/cgihttpserverbiao-zhun-ku-yuan-ma-xue-xi.html" />
<meta property="og:description" content="Contents 简介 CGIHTTPRequestHandler rbufsize = 0 cgi_directories _url_collapse_path CGI 环境变量 bug #427345 nobody_uid executable 简介 CGIHTTPRequestHandler 是继承自 SimpleHTTPServer.SimpleHTTPRequestHandler 的。 它定义了一个 POST 方法来支持 CGI 脚本。 Tip GET 、 HEAD 都是支持用 CGI 脚本的，但是本模块仅定义了 POST 方法。 如果当前系统（比如 Windows）没有 os.fork() 函数，那么就会调用 os.popen2() 函数。 如果连该函数也没有（比如 Macntosh），那么只能利用当前 Python 进程执行 ..." />
<meta property="og:site_name" content="January Star" />
<meta property="og:article:author" content="Chen Jie" />
<meta property="og:article:published_time" content="2014-12-01T15:37:06.833024" />
<meta name="twitter:title" content="CGIHTTPServer标准库源码学习 ">
<meta name="twitter:description" content="Contents 简介 CGIHTTPRequestHandler rbufsize = 0 cgi_directories _url_collapse_path CGI 环境变量 bug #427345 nobody_uid executable 简介 CGIHTTPRequestHandler 是继承自 SimpleHTTPServer.SimpleHTTPRequestHandler 的。 它定义了一个 POST 方法来支持 CGI 脚本。 Tip GET 、 HEAD 都是支持用 CGI 脚本的，但是本模块仅定义了 POST 方法。 如果当前系统（比如 Windows）没有 os.fork() 函数，那么就会调用 os.popen2() 函数。 如果连该函数也没有（比如 Macntosh），那么只能利用当前 Python 进程执行 ...">

        <title>CGIHTTPServer标准库源码学习  · January Star
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/css/custom.css" media="screen">
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-52167018-1', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <div class="span1"></div>
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://chenjiee815.github.io/"><span class=site-name>January Star</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://chenjiee815.github.io">Home</a></li>
                            <li ><a href="http://chenjiee815.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://chenjiee815.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://chenjiee815.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://chenjiee815.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://chenjiee815.github.io/cgihttpserverbiao-zhun-ku-yuan-ma-xue-xi.html"> CGIHTTPServer标准库源码学习  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#id1" id="id3"> 简介 </a></li>
<li><a class="reference internal" href="#cgihttprequesthandler" id="id4">CGIHTTPRequestHandler</a><ul>
<li><a class="reference internal" href="#rbufsize-0" id="id5">rbufsize = 0</a></li>
<li><a class="reference internal" href="#cgi-directories" id="id6">cgi_directories</a></li>
<li><a class="reference internal" href="#url-collapse-path" id="id7">_url_collapse_path</a></li>
<li><a class="reference internal" href="#cgi" id="id8">CGI 环境变量 </a></li>
<li><a class="reference internal" href="#bug-427345" id="id9">bug #427345</a></li>
<li><a class="reference internal" href="#nobody-uid" id="id10">nobody_uid</a></li>
<li><a class="reference internal" href="#executable" id="id11">executable</a></li>
</ul>
</li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="id1">
<h2><a class="toc-backref" href="#id3"> 简介 </a></h2>
<p><cite>CGIHTTPRequestHandler</cite> 是继承自 <cite>SimpleHTTPServer.SimpleHTTPRequestHandler</cite> 的。</p>
<p> 它定义了一个 <cite>POST</cite> 方法来支持 CGI 脚本。</p>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last"><cite>GET</cite> 、 <cite>HEAD</cite> 都是支持用 CGI 脚本的，但是本模块仅定义了 <cite>POST</cite> 方法。</p>
</div>
<p> 如果当前系统（比如 Windows）没有 <cite>os.fork()</cite> 函数，那么就会调用 <cite>os.popen2()</cite> 函数。</p>
<p> 如果连该函数也没有（比如 Macntosh），那么只能利用当前 Python 进程执行 Python 代码编写的 CGI 脚本。</p>
<p> 本模块处理所有 HTTP 请求都是同步模式。</p>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p> 本模块实现的 <cite>CGIHTTPServer</cite> 在安全方面未作考虑，它可以执行任意的 Python 代码或者外部程序。</p>
<p class="last"> 最好不要使用在生产环境当中，除非你有严格的防护设备（防火墙等等）。</p>
</div>
<div class="note">
<p class="first admonition-title">Note</p>
<p> 由于在调用 CGI 脚本之前， <cite>200 OK</cite> 的返回码已经写入到 <cite>wfile</cite> 中了，</p>
<p class="last"> 所以在 CGI 脚本中是不能再写入其它返回码的。</p>
</div>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last"> 如果想深入了解 CGI，参见 <a class="reference external" href="http://www.cgi101.com/">CGI 101</a></p>
</div>
</div>
<div class="section" id="cgihttprequesthandler">
<h2><a class="toc-backref" href="#id4">CGIHTTPRequestHandler</a></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CGIHTTPRequestHandler</span><span class="p">(</span><span class="n">SimpleHTTPServer</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">):</span>

    <span class="c"># 检测运行服务的平台为哪类操作系统 </span>
    <span class="n">have_fork</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;fork&#39;</span><span class="p">)</span>
    <span class="n">have_popen2</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;popen2&#39;</span><span class="p">)</span>
    <span class="n">have_popen3</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="s">&#39;popen3&#39;</span><span class="p">)</span>

    <span class="c"># 关闭输入的缓存功能 </span>
    <span class="n">rbufsize</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cgi</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">run_cgi</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">501</span><span class="p">,</span> <span class="s">&quot;Can only POST to CGI scripts&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_head</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_cgi</span><span class="p">():</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_cgi</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SimpleHTTPServer</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="o">.</span><span class="n">send_head</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_cgi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 判断请求的路径是否为一个 CGI 脚本 </span>

<span class="sd">        如果为一个 CGI 脚本，则更新 self.cgi_info 属性 (dir, rest), 并返回 True，否则返回 False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">collapsed_path</span> <span class="o">=</span> <span class="n">_url_collapse_path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
        <span class="c"># 下面两行代码可以用一行代码代替 </span>
        <span class="c"># head, _, tail = collapsed_path.partition(&#39;/&#39;)</span>
        <span class="n">dir_sep</span> <span class="o">=</span> <span class="n">collapsed_path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">collapsed_path</span><span class="p">[:</span><span class="n">dir_sep</span><span class="p">],</span> <span class="n">collapsed_path</span><span class="p">[</span><span class="n">dir_sep</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="c"># 只允许运行 CGI 脚本存放目录中的脚本 / 程序，</span>
        <span class="c"># 由于 `_url_collapse_path` 已经对请求路径进行压缩过滤，所以这里简单判断即可 </span>
        <span class="k">if</span> <span class="n">head</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgi_directories</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cgi_info</span> <span class="o">=</span> <span class="n">head</span><span class="p">,</span> <span class="n">tail</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">return</span> <span class="bp">False</span>

    <span class="n">cgi_directories</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/cgi-bin&#39;</span><span class="p">,</span> <span class="s">&#39;/htbin&#39;</span><span class="p">]</span> <span class="c"># CGI 脚本的存放目录 </span>

    <span class="k">def</span> <span class="nf">is_executable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">executable</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_python</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 判断某文件是否为 Python 脚本 &quot;&quot;&quot;</span>
        <span class="n">head</span><span class="p">,</span> <span class="n">tail</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">tail</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&quot;.py&quot;</span><span class="p">,</span> <span class="s">&quot;.pyw&quot;</span><span class="p">)</span> <span class="c"># 其实还有 pyc,pyo... ...</span>

    <span class="k">def</span> <span class="nf">run_cgi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># 这个函数巨长无比 ... ...</span>
        <span class="c"># 解析请求路径 </span>
        <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="nb">dir</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cgi_info</span>

        <span class="n">i</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">nextdir</span> <span class="o">=</span> <span class="n">path</span><span class="p">[:</span><span class="n">i</span><span class="p">]</span>
            <span class="n">nextrest</span> <span class="o">=</span> <span class="n">path</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>

            <span class="n">scriptdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_path</span><span class="p">(</span><span class="n">nextdir</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">scriptdir</span><span class="p">):</span>
                <span class="nb">dir</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">nextdir</span><span class="p">,</span> <span class="n">nextrest</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c"># find an explicit query string, if present.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s">&#39;?&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rest</span><span class="p">,</span> <span class="n">query</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">rest</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

        <span class="c"># dissect the part after the directory name into a script name &amp;</span>
        <span class="c"># a possible additional path, to be stored in PATH_INFO.</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">rest</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">rest</span><span class="p">[:</span><span class="n">i</span><span class="p">],</span> <span class="n">rest</span><span class="p">[</span><span class="n">i</span><span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">script</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">rest</span><span class="p">,</span> <span class="s">&#39;&#39;</span>

        <span class="n">scriptname</span> <span class="o">=</span> <span class="nb">dir</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">script</span>
        <span class="n">scriptfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_path</span><span class="p">(</span><span class="n">scriptname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">404</span><span class="p">,</span> <span class="s">&quot;No such CGI script (</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span> <span class="n">scriptname</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s">&quot;CGI script is not a plain file (</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span>
                            <span class="n">scriptname</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">ispy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_python</span><span class="p">(</span><span class="n">scriptname</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">ispy</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">have_fork</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_popen2</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_popen3</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s">&quot;CGI script is not a Python script (</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span>
                                <span class="n">scriptname</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_executable</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_error</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s">&quot;CGI script is not executable (</span><span class="si">%r</span><span class="s">)&quot;</span> <span class="o">%</span>
                                <span class="n">scriptname</span><span class="p">)</span>
                <span class="k">return</span>

        <span class="c"># 启动 CGI 脚本所需要的环境变量 </span>
        <span class="n">env</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;SERVER_SOFTWARE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">version_string</span><span class="p">()</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;SERVER_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_name</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;GATEWAY_INTERFACE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;CGI/1.1&#39;</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;SERVER_PROTOCOL&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">protocol_version</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;SERVER_PORT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">server_port</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span>
        <span class="n">uqrest</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">unquote</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;PATH_INFO&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">uqrest</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;PATH_TRANSLATED&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">translate_path</span><span class="p">(</span><span class="n">uqrest</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;SCRIPT_NAME&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scriptname</span>
        <span class="k">if</span> <span class="n">query</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span>
        <span class="n">host</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">address_string</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">host</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;REMOTE_HOST&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">host</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;REMOTE_ADDR&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&quot;authorization&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">authorization</span><span class="p">:</span>
            <span class="n">authorization</span> <span class="o">=</span> <span class="n">authorization</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">authorization</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">base64</span><span class="o">,</span> <span class="nn">binascii</span>
                <span class="n">env</span><span class="p">[</span><span class="s">&#39;AUTH_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authorization</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">authorization</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;basic&quot;</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">authorization</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">decodestring</span><span class="p">(</span><span class="n">authorization</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="k">except</span> <span class="n">binascii</span><span class="o">.</span><span class="n">Error</span><span class="p">:</span>
                        <span class="k">pass</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">authorization</span> <span class="o">=</span> <span class="n">authorization</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;:&#39;</span><span class="p">)</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">authorization</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">env</span><span class="p">[</span><span class="s">&#39;REMOTE_USER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">authorization</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c"># XXX REMOTE_IDENT</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">typeheader</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;CONTENT_TYPE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">typeheader</span>
        <span class="n">length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;content-length&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">length</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;CONTENT_LENGTH&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">length</span>
        <span class="n">referer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;referer&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">referer</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;HTTP_REFERER&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">referer</span>
        <span class="n">accept</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getallmatchingheaders</span><span class="p">(</span><span class="s">&#39;accept&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s">&quot;</span><span class="se">\t\n\r</span><span class="s"> &quot;</span><span class="p">:</span>
                <span class="n">accept</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">accept</span> <span class="o">=</span> <span class="n">accept</span> <span class="o">+</span> <span class="n">line</span><span class="p">[</span><span class="mi">7</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="p">[</span><span class="s">&#39;HTTP_ACCEPT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">accept</span><span class="p">)</span>
        <span class="n">ua</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="s">&#39;user-agent&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ua</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;HTTP_USER_AGENT&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ua</span>
        <span class="n">co</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getheaders</span><span class="p">(</span><span class="s">&#39;cookie&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">co</span><span class="p">:</span>
            <span class="n">env</span><span class="p">[</span><span class="s">&#39;HTTP_COOKIE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">co</span><span class="p">)</span>
        <span class="c"># XXX Other HTTP_* headers</span>
        <span class="c"># Since we&#39;re setting the env in the parent, provide empty</span>
        <span class="c"># values to override previously set values</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;QUERY_STRING&#39;</span><span class="p">,</span> <span class="s">&#39;REMOTE_HOST&#39;</span><span class="p">,</span> <span class="s">&#39;CONTENT_LENGTH&#39;</span><span class="p">,</span>
                  <span class="s">&#39;HTTP_USER_AGENT&#39;</span><span class="p">,</span> <span class="s">&#39;HTTP_COOKIE&#39;</span><span class="p">,</span> <span class="s">&#39;HTTP_REFERER&#39;</span><span class="p">):</span>
            <span class="n">env</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s">&quot;Script output follows&quot;</span><span class="p">)</span>

        <span class="n">decoded_query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;+&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">have_fork</span><span class="p">:</span>
            <span class="c"># 在 Unix 平台上，使用 fork&amp;&amp;exec 形式启动子进程 </span>
            <span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="n">script</span><span class="p">]</span>
            <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">decoded_query</span><span class="p">:</span>
                <span class="n">args</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">decoded_query</span><span class="p">)</span>
            <span class="n">nobody</span> <span class="o">=</span> <span class="n">nobody_uid</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c"># Always flush before forking</span>
            <span class="n">pid</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fork</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pid</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c"># Parent</span>
                <span class="n">pid</span><span class="p">,</span> <span class="n">sts</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">waitpid</span><span class="p">(</span><span class="n">pid</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="c"># throw away additional data [see bug #427345]</span>
                <span class="k">while</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                        <span class="k">break</span>
                <span class="k">if</span> <span class="n">sts</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s">&quot;CGI script exit status </span><span class="si">%#x</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">sts</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="c"># Child</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">setuid</span><span class="p">(</span><span class="n">nobody</span><span class="p">)</span>
                <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="c"># 将请求内容读取及响应写入文件映射到子进程的标准输入 / 输出接口 </span>
                <span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">dup2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">execve</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">env</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">handle_error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">client_address</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">_exit</span><span class="p">(</span><span class="mi">127</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># 非 Unix 平台，使用 subprocess 来启动子进程 </span>
            <span class="kn">import</span> <span class="nn">subprocess</span>
            <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">scriptfile</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_python</span><span class="p">(</span><span class="n">scriptfile</span><span class="p">):</span>
                <span class="n">interp</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
                <span class="k">if</span> <span class="n">interp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;w.exe&quot;</span><span class="p">):</span>
                    <span class="c"># On Windows, use python.exe, not pythonw.exe</span>
                    <span class="n">interp</span> <span class="o">=</span> <span class="n">interp</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="n">interp</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span>
                <span class="n">cmdline</span> <span class="o">=</span> <span class="p">[</span><span class="n">interp</span><span class="p">,</span> <span class="s">&#39;-u&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cmdline</span>
            <span class="k">if</span> <span class="s">&#39;=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
                <span class="n">cmdline</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="s">&quot;command: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">list2cmdline</span><span class="p">(</span><span class="n">cmdline</span><span class="p">))</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">nbytes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">nbytes</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdline</span><span class="p">,</span>
                                 <span class="n">stdin</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                 <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                 <span class="n">stderr</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
                                 <span class="n">env</span> <span class="o">=</span> <span class="n">env</span>
                                <span class="p">)</span>
            <span class="c"># 注意：请求及响应的数据，是在父进程处理的 </span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">command</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s">&quot;post&quot;</span> <span class="ow">and</span> <span class="n">nbytes</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">nbytes</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="c"># throw away additional data [see bug #427345]</span>
            <span class="k">while</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">_sock</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
                    <span class="k">break</span>
            <span class="n">stdout</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">stdout</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">stderr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">stderr</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">p</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">returncode</span>
            <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_error</span><span class="p">(</span><span class="s">&quot;CGI script exit status </span><span class="si">%#x</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log_message</span><span class="p">(</span><span class="s">&quot;CGI script exited OK&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table><div class="section" id="rbufsize-0">
<h3><a class="toc-backref" href="#id5">rbufsize = 0</a></h3>
<p> 上面的代码中这样做，主要是为了关闭输入的缓存功能。</p>
<p> 父进程从输入中读取一行，然后根据第一行中的 <cite>path</cite> 来以子进程的形式调用 CGI 脚本。</p>
<p> 在启动子进程时，子进程便会拥有父进程所有资源的一份拷贝，</p>
<p> 这样，CGI 脚本就可以从输入中读取剩下的数据。</p>
</div>
<div class="section" id="cgi-directories">
<h3><a class="toc-backref" href="#id6">cgi_directories</a></h3>
<p>CGI 程序的存放目录 </p>
<p><cite>CGIHTTPRequestHandler</cite> 类中定义了两个目录 </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">cgi_directories</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;/cgi-bin&#39;</span><span class="p">,</span> <span class="s">&#39;/htbin&#39;</span><span class="p">]</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="url-collapse-path">
<h3><a class="toc-backref" href="#id7">_url_collapse_path</a></h3>
<p> 本函数主要是将 CGI 脚本请求路径进行压缩过滤（ <cite>..</cite> 表示上级目录， <cite>.</cite> 表示当前目录），防止其指向 CGI 脚本存放目录之外的程序。</p>
<p> 比如：</p>
<blockquote>
<cite>cgi-bin</cite> 目录安装在 <cite>/opt</cite> 目录下， <cite>/cgi-bin/../../bin/ls</cite> 就指向了 <cite>/bin/ls</cite> 程序。</blockquote>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p> 如果 CGI 脚本的请求路径有过多的 <cite>..</cite> ，且导致真实的引用路径为 CGI 脚本存放目录之外的目录，</p>
<p class="last"> 就会导致本函数抛出 <cite>IndexError</cite> 异常。</p>
</div>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last"> 本文部分参考了 <a class="reference external" href="https://www.cs.tut.fi/~jkorpela/rfc/2396/full.html#5.2">RFC-2396:5.2</a> 规范的相对路径解析算法。</p>
</div>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last"> 一般在解析路径时，将路径按照 <cite>dirname</cite> 、 <cite>basename</cite> 来解析是很常见的思路。</p>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">_url_collapse_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="n">path_parts</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
    <span class="n">head_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c"># dirname: path_parts[:-1]</span>
    <span class="c"># 压缩 dirname 中过多的 `..` ，去除 dirname 中的 `.`</span>
    <span class="k">for</span> <span class="n">part</span> <span class="ow">in</span> <span class="n">path_parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">part</span> <span class="o">==</span> <span class="s">&#39;..&#39;</span><span class="p">:</span>
            <span class="n">head_parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="c"># IndexError if more &#39;..&#39; than prior parts</span>
        <span class="k">elif</span> <span class="n">part</span> <span class="ow">and</span> <span class="n">part</span> <span class="o">!=</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
            <span class="n">head_parts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">part</span> <span class="p">)</span>

    <span class="c"># basename: tail_part</span>
    <span class="k">if</span> <span class="n">path_parts</span><span class="p">:</span>
        <span class="n">tail_part</span> <span class="o">=</span> <span class="n">path_parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">tail_part</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tail_part</span> <span class="o">==</span> <span class="s">&#39;..&#39;</span><span class="p">:</span>
                <span class="n">head_parts</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
                <span class="n">tail_part</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
            <span class="k">elif</span> <span class="n">tail_part</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
                <span class="n">tail_part</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">tail_part</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

    <span class="c"># 将经过压缩处理的 dirname, basename 再合并为新的路径 </span>
    <span class="n">splitpath</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="s">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">head_parts</span><span class="p">),</span> <span class="n">tail_part</span><span class="p">)</span>
    <span class="n">collapsed_path</span> <span class="o">=</span> <span class="s">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">splitpath</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">collapsed_path</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="cgi">
<h3><a class="toc-backref" href="#id8">CGI 环境变量 </a></h3>
<p> 一个客户端的 HTTP 请求到服务端，有很多与其相关的附属信息，比如客户端的主机名、客户端 IP 等等，</p>
<p> 那么 CGI 服务端是通过将这些信息写入到环境变量中来让 CGI 脚本读取的。</p>
<p> 详细内容参见 <a class="reference external" href="http://www.cgi101.com/class/ch3/text.html">CGI ENV</a></p>
<div class="note">
<p class="first admonition-title">Note</p>
<p> 原代码中引用的网页为 <cite>http://hoohoo.ncsa.uiuc.edu/cgi/env.html</cite> ，</p>
<p class="last"> 但该网页貌似打不开了，我就重新找了一个有关 CGI 环境变量说明的网页。</p>
</div>
</div>
<div class="section" id="bug-427345">
<h3><a class="toc-backref" href="#id9">bug #427345</a></h3>
<p> 详见 <a class="reference external" href="http://bugs.python.org/issue427345">bug #427345</a></p>
<p> 该 Bug 主要由于 Windows 平台的 IE 浏览器导致的。</p>
<p>IE 浏览器发送的数据和其指定的 <cite>Content-length</cite> 不对应，它在请求数据的结尾多传入了 <cite>rn</cite> ，但并没有在 <cite>Content-length</cite> 中体现。</p>
<p> 所以在代码中就出现了如下代码，用于忽略多余的请求数据：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">while</span> <span class="n">select</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">_sock</span><span class="p">],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">_sock</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">break</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="nobody-uid">
<h3><a class="toc-backref" href="#id10">nobody_uid</a></h3>
<p> 获取 <cite>nobody</cite> 用户的 UID。</p>
<p> 目前许多 Unix 系统都会默认创建一个 <cite>nobody</cite> 用户，它一个不能登陆的帐号。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="nv">$ </span>grep nobody /etc/passwd
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
</pre></div>
</td></tr></table><p> 创建该帐号主要是为了尽量限制该用户的权限至最小，当服务器向外提供服务时，可能会让 client 以 nobody 的身份登录。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">nobody</span> <span class="o">=</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">nobody_uid</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;Internal routine to get nobody&#39;s uid&quot;&quot;&quot;</span>
    <span class="k">global</span> <span class="n">nobody</span>
    <span class="k">if</span> <span class="n">nobody</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">nobody</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span> <span class="nn">pwd</span>
    <span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">nobody</span> <span class="o">=</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwnam</span><span class="p">(</span><span class="s">&#39;nobody&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c"># 如果系统没有 nobody 则找到系统中最大的 UID+1 即为 nobody 的 UID</span>
        <span class="n">nobody</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">pwd</span><span class="o">.</span><span class="n">getpwall</span><span class="p">()))</span>
    <span class="k">return</span> <span class="n">nobody</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="executable">
<h3><a class="toc-backref" href="#id11">executable</a></h3>
<p> 检查某文件是否为可执行文件 </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">executable</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">st</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">os</span><span class="o">.</span><span class="n">error</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mo">0111</span> <span class="o">!=</span> <span class="mi">0</span>
</pre></div>
</td></tr></table><p> 嗯，有个魔法数字 <cite>0111</cite> ，这个我先不直接解释，咱们从头理一下。</p>
<p><cite>os.stat</cite> 对应 C 语言的 <cite>stat</cite> 函数。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="cp">#include &lt;sys/stat.h&gt;</span>
<span class="cp">#include &lt;unistd.h&gt;</span>

<span class="kt">int</span> <span class="nf">stat</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">file_name</span><span class="p">,</span> <span class="k">struct</span> <span class="n">stat</span> <span class="o">*</span><span class="n">buf</span><span class="p">);</span>
</pre></div>
</td></tr></table><p><cite>stat</cite> 函数执行成功返回 0，失败返回 -1。取得的文件状态存放在 buf 指针指向的 struct stat 结构体中。</p>
<p> 该结构体结构如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">struct</span> <span class="n">stat</span>
<span class="p">{</span>
    <span class="kt">dev_t</span>       <span class="n">st_dev</span><span class="p">;</span>     <span class="cm">/* ID of device containing file - 文件所在设备的 ID*/</span>
    <span class="kt">ino_t</span>       <span class="n">st_ino</span><span class="p">;</span>     <span class="cm">/* inode number -inode 节点号 */</span>
    <span class="kt">mode_t</span>      <span class="n">st_mode</span><span class="p">;</span>    <span class="cm">/* 文件的类型和存取的权限 */</span>
    <span class="kt">nlink_t</span>     <span class="n">st_nlink</span><span class="p">;</span>   <span class="cm">/* number of hard links - 链向此文件的连接数 ( 硬连接 )*/</span>
    <span class="kt">uid_t</span>       <span class="n">st_uid</span><span class="p">;</span>     <span class="cm">/* user ID of owner - 用户 ID*/</span>
    <span class="kt">gid_t</span>       <span class="n">st_gid</span><span class="p">;</span>     <span class="cm">/* group ID of owner - 组 ID*/</span>
    <span class="kt">dev_t</span>       <span class="n">st_rdev</span><span class="p">;</span>    <span class="cm">/* device ID (if special file) - 设备号，针对设备文件 */</span>
    <span class="kt">off_t</span>       <span class="n">st_size</span><span class="p">;</span>    <span class="cm">/* total size, in bytes - 文件大小，字节为单位 */</span>
    <span class="kt">blksize_t</span>   <span class="n">st_blksize</span><span class="p">;</span> <span class="cm">/* blocksize for filesystem I/O - 系统块的大小 */</span>
    <span class="kt">blkcnt_t</span>    <span class="n">st_blocks</span><span class="p">;</span>  <span class="cm">/* number of blocks allocated - 文件所占块数 */</span>
    <span class="kt">time_t</span>      <span class="n">st_atime</span><span class="p">;</span>   <span class="cm">/* time of last access - 最近存取时间 */</span>
    <span class="kt">time_t</span>      <span class="n">st_mtime</span><span class="p">;</span>   <span class="cm">/* time of last modification - 最近修改时间 */</span>
    <span class="kt">time_t</span>      <span class="n">st_ctime</span><span class="p">;</span>   <span class="cm">/* time of last status change - 最近状态改变时间 */</span>
<span class="p">};</span>
</pre></div>
</td></tr></table><p> 我们只看其中的 <cite>st_mode</cite> 。</p>
<p>mode_t 其实就是普通的 unsigned int.</p>
<p> 目前，st_mode 只使用了其低 16 位 (00001~0170000) 来表示各个特征位，高 16 位估计为了以后扩展吧。</p>
<p> 每个特征位的定义如下：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span class="cm">/* 12~15 位表示类型 */</span>
<span class="n">S_IFMT</span>      <span class="mo">0170000</span>     <span class="err"> 文件类型的位遮罩 </span>
<span class="n">S_IFSOCK</span>    <span class="mo">0140000</span>     <span class="n">socket</span>
<span class="n">S_IFLNK</span>     <span class="mo">0120000</span>     <span class="err"> 符号链接 </span><span class="p">(</span><span class="n">symbolic</span> <span class="n">link</span><span class="p">)</span>
<span class="n">S_IFREG</span>     <span class="mo">0100000</span>     <span class="err"> 一般文件 </span>
<span class="n">S_IFBLK</span>     <span class="mo">0060000</span>     <span class="err"> 区块装置 </span><span class="p">(</span><span class="n">block</span> <span class="n">device</span><span class="p">)</span>
<span class="n">S_IFDIR</span>     <span class="mo">0040000</span>     <span class="err"> 目录 </span>
<span class="n">S_IFCHR</span>     <span class="mo">0020000</span>     <span class="err"> 字符装置 </span><span class="p">(</span><span class="n">character</span> <span class="n">device</span><span class="p">)</span>
<span class="n">S_IFIFO</span>     <span class="mo">0010000</span>     <span class="err"> 管道 </span><span class="p">(</span><span class="n">fifo</span><span class="p">)</span>

<span class="cm">/* 9~11 位表示特殊属性 */</span>
<span class="n">S_ISUID</span>     <span class="mo">0004000</span>     <span class="err"> 文件的 </span><span class="p">(</span><span class="n">set</span> <span class="n">user</span><span class="o">-</span><span class="n">id</span> <span class="n">on</span> <span class="n">execution</span><span class="p">)</span><span class="err"> 位 </span>
<span class="n">S_ISGID</span>     <span class="mo">0002000</span>     <span class="err"> 文件的 </span><span class="p">(</span><span class="n">set</span> <span class="n">group</span><span class="o">-</span><span class="n">id</span> <span class="n">on</span> <span class="n">execution</span><span class="p">)</span><span class="err"> 位 </span>
<span class="n">S_ISVTX</span>     <span class="mo">0001000</span>     <span class="err"> 文件的 </span><span class="n">sticky</span><span class="err"> 位 </span>

<span class="cm">/* 0~8 位表示权限 */</span>
<span class="n">S_IRWXU</span>     <span class="mo">00700</span>       <span class="err"> 文件所有者的遮罩值 </span><span class="p">(</span><span class="err"> 即所有权限值 </span><span class="p">)</span>
<span class="n">S_IRUSR</span>     <span class="mo">00400</span>       <span class="err"> 文件所有者具可读取权限 </span>
<span class="n">S_IWUSR</span>     <span class="mo">00200</span>       <span class="err"> 文件所有者具可写入权限 </span>
<span class="n">S_IXUSR</span>     <span class="mo">00100</span>       <span class="err"> 文件所有者具可执行权限 </span>

<span class="n">S_IRWXG</span>     <span class="mo">00070</span>       <span class="err"> 用户组的遮罩值 </span><span class="p">(</span><span class="err"> 即所有权限值 </span><span class="p">)</span>
<span class="n">S_IRGRP</span>     <span class="mo">00040</span>       <span class="err"> 用户组具可读取权限 </span>
<span class="n">S_IWGRP</span>     <span class="mo">00020</span>       <span class="err"> 用户组具可写入权限 </span>
<span class="n">S_IXGRP</span>     <span class="mo">00010</span>       <span class="err"> 用户组具可执行权限 </span>

<span class="n">S_IRWXO</span>     <span class="mo">00007</span>       <span class="err"> 其他用户的遮罩值 </span><span class="p">(</span><span class="err"> 即所有权限值 </span><span class="p">)</span>
<span class="n">S_IROTH</span>     <span class="mo">00004</span>       <span class="err"> 其他用户具可读取权限 </span>
<span class="n">S_IWOTH</span>     <span class="mo">00002</span>       <span class="err"> 其他用户具可写入权限 </span>
<span class="n">S_IXOTH</span>     <span class="mo">00001</span>       <span class="err"> 其他用户具可执行权限 </span>
</pre></div>
</td></tr></table><p> 一般用法是用相应的特征位与文件的 st_mode 的值相与，再比较。</p>
<p> 比如下面判断 <cite>chapter_1.rst</cite> 是否为一个文件。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">257</span><span class="p">]:</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;chapter_1.rst&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFREG</span> <span class="o">==</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IFREG</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">257</span><span class="p">]:</span> <span class="bp">True</span>
</pre></div>
</td></tr></table><p> 经过上面的解释， <cite>executable</cite> 函数中的那个魔法数字 <cite>0111</cite> 就能够知道是 </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">269</span><span class="p">]:</span> <span class="nb">oct</span><span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">S_IXUSR</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXGRP</span> <span class="o">|</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXOTH</span><span class="p">)</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">269</span><span class="p">]:</span> <span class="s">&#39;0111&#39;</span>
</pre></div>
</td></tr></table><p> 至于为什么要等于 0, 看下面的代码就知道了。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">In</span> <span class="p">[</span><span class="mi">258</span><span class="p">]:</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXUSR</span> <span class="o">&amp;</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXGRP</span> <span class="o">&amp;</span> <span class="n">stat</span><span class="o">.</span><span class="n">S_IXOTH</span>
<span class="n">Out</span><span class="p">[</span><span class="mi">267</span><span class="p">]:</span> <span class="mi">0</span>
</pre></div>
</td></tr></table></div>
</div>

            
            <section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://chenjiee815.github.io/cgihttpserverbiao-zhun-ku-yuan-ma-xue-xi.html#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'chenjiee815blog';
        var disqus_identifier = 'http://chenjiee815.github.io/cgihttpserverbiao-zhun-ku-yuan-ma-xue-xi.html';
    var disqus_url = 'http://chenjiee815.github.io/cgihttpserverbiao-zhun-ku-yuan-ma-xue-xi.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2014-12-01T15:37:06.833024">Dec 1, 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="http://chenjiee815.github.io/categories.html#python-ref">Python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://chenjiee815.github.io/tags.html#python-ref">python
                    <span>22</span>
</a></li>
                <li><a href="http://chenjiee815.github.io/tags.html#stdlibs-ref">stdlibs
                    <span>14</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="http://www.htdp.org/" title="My HTDP Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-htdp sidebar-social-links"></i></a>
    <a href="http://mitpress.mit.edu/sicp/" title="My SICP Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-sicp sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>

                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'chenjiee815blog';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>