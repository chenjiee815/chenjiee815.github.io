<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Chen Jie" />
        <meta name="copyright" content="Chen Jie" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="python, stdlibs, Python, " />

<meta property="og:title" content="SimpleXMLRPCServer标准库源码学习 "/>
<meta property="og:url" content="http://chenjiee815.github.io/simplexmlrpcserverbiao-zhun-ku-yuan-ma-xue-xi.html" />
<meta property="og:description" content="Contents XML-RPC 简介 请求消息 响应消息 简介 辅助函数 resolve_dotted_attribute list_public_methods remove_duplicates SimpleXMLRPCDispatcher register_introspection_functions allow_dotted_names SimpleXMLRPCRequestHandler MTU Issue792570 HTTP 压缩 SimpleXMLRPCServer _send_traceback_header Issue1222790 MultiPathXMLRPCServer CGIXMLRPCRequestHandler XML-RPC 简介 全称 XML Remote Procedure Call ，即 XML 远程方法调用。它使用 http/https 作为传输协议，XML 作为传送信息的编码格式。 下面每个格式中的 XML 不暂时不作具体解释了，基本一看就明了，而且解析该内容的具体工作是由 xmlrpclib 模块完成的，到讲解 xmlrpclib 模块时再作具体的分析。 如果想要深入了解 ..." />
<meta property="og:site_name" content="January Star" />
<meta property="og:article:author" content="Chen Jie" />
<meta property="og:article:published_time" content="2014-12-08T19:44:54.008779" />
<meta name="twitter:title" content="SimpleXMLRPCServer标准库源码学习 ">
<meta name="twitter:description" content="Contents XML-RPC 简介 请求消息 响应消息 简介 辅助函数 resolve_dotted_attribute list_public_methods remove_duplicates SimpleXMLRPCDispatcher register_introspection_functions allow_dotted_names SimpleXMLRPCRequestHandler MTU Issue792570 HTTP 压缩 SimpleXMLRPCServer _send_traceback_header Issue1222790 MultiPathXMLRPCServer CGIXMLRPCRequestHandler XML-RPC 简介 全称 XML Remote Procedure Call ，即 XML 远程方法调用。它使用 http/https 作为传输协议，XML 作为传送信息的编码格式。 下面每个格式中的 XML 不暂时不作具体解释了，基本一看就明了，而且解析该内容的具体工作是由 xmlrpclib 模块完成的，到讲解 xmlrpclib 模块时再作具体的分析。 如果想要深入了解 ...">

        <title>SimpleXMLRPCServer标准库源码学习  · January Star
</title>
        <link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/css/bootstrap-combined.min.css" rel="stylesheet">
        <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.1/css/font-awesome.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/css/pygments.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/tipuesearch/tipuesearch.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/css/elegant.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://chenjiee815.github.io/theme/css/custom.css" media="screen">
<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
     (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
     m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
     })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-52167018-1', 'auto');
    ga('send', 'pageview');
</script>
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <div class="span1"></div>
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://chenjiee815.github.io/"><span class=site-name>January Star</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://chenjiee815.github.io">Home</a></li>
                            <li ><a href="http://chenjiee815.github.io/categories.html">Categories</a></li>
                            <li ><a href="http://chenjiee815.github.io/tags.html">Tags</a></li>
                            <li ><a href="http://chenjiee815.github.io/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://chenjiee815.github.io/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page-header span10 offset2">
    <h1><a href="http://chenjiee815.github.io/simplexmlrpcserverbiao-zhun-ku-yuan-ma-xue-xi.html"> SimpleXMLRPCServer标准库源码学习  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            
            <div class="contents topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#xml-rpc" id="id7">XML-RPC 简介 </a><ul>
<li><a class="reference internal" href="#id1" id="id8"> 请求消息 </a></li>
<li><a class="reference internal" href="#id2" id="id9"> 响应消息 </a></li>
</ul>
</li>
<li><a class="reference internal" href="#id3" id="id10"> 简介 </a></li>
<li><a class="reference internal" href="#id4" id="id11"> 辅助函数 </a><ul>
<li><a class="reference internal" href="#resolve-dotted-attribute" id="id12">resolve_dotted_attribute</a></li>
<li><a class="reference internal" href="#list-public-methods" id="id13">list_public_methods</a></li>
<li><a class="reference internal" href="#remove-duplicates" id="id14">remove_duplicates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simplexmlrpcdispatcher" id="id15">SimpleXMLRPCDispatcher</a><ul>
<li><a class="reference internal" href="#register-introspection-functions" id="id16">register_introspection_functions</a></li>
<li><a class="reference internal" href="#allow-dotted-names" id="id17">allow_dotted_names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#simplexmlrpcrequesthandler" id="id18">SimpleXMLRPCRequestHandler</a><ul>
<li><a class="reference internal" href="#mtu" id="id19">MTU</a></li>
<li><a class="reference internal" href="#issue792570" id="id20">Issue792570</a></li>
<li><a class="reference internal" href="#http" id="id21">HTTP 压缩 </a></li>
</ul>
</li>
<li><a class="reference internal" href="#id5" id="id22">SimpleXMLRPCServer</a><ul>
<li><a class="reference internal" href="#send-traceback-header" id="id23">_send_traceback_header</a></li>
<li><a class="reference internal" href="#issue1222790" id="id24">Issue1222790</a></li>
</ul>
</li>
<li><a class="reference internal" href="#multipathxmlrpcserver" id="id25">MultiPathXMLRPCServer</a></li>
<li><a class="reference internal" href="#cgixmlrpcrequesthandler" id="id26">CGIXMLRPCRequestHandler</a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="xml-rpc">
<h2><a class="toc-backref" href="#id7">XML-RPC 简介 </a></h2>
<p> 全称 <cite>XML Remote Procedure Call</cite> ，即 XML 远程方法调用。它使用 http/https 作为传输协议，XML 作为传送信息的编码格式。</p>
<p> 下面每个格式中的 XML 不暂时不作具体解释了，基本一看就明了，而且解析该内容的具体工作是由 <cite>xmlrpclib</cite> 模块完成的，到讲解 <cite>xmlrpclib</cite> 模块时再作具体的分析。</p>
<p> 如果想要深入了解 XML-RPC，请参见 <a class="reference external" href="http://xmlrpc.scripting.com/default.html">XML-RPC 主页 </a> 和 <a class="reference external" href="http://zh.wikipedia.org/wiki/XML-RPC">WiKi XML-RPC</a></p>
<div class="section" id="id1">
<h3><a class="toc-backref" href="#id8"> 请求消息 </a></h3>
<p> 一个 XML-RPC 请求必须为 POST 请求，它的消息体为 XML 格式。</p>
<p> 请求首行中的 URL 一般来说为 <cite>/RPC2</cite> ，但不作强制要求，可为空，也可为 <cite>/</cite> 。</p>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last"> 但本模块只支持 <cite>('/', '/RPC2')</cite></p>
</div>
<p><cite>User-Agent</cite> 和 <cite>Host</cite> 必须要指定。</p>
<p><cite>Content-Type</cite> 必须指定为 <cite>text/xml</cite> 。</p>
<p><cite>Content-Length</cite> 必须指定，并且一定要等于消息体的长度。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre>POST /RPC2 HTTP/1.0
User-Agent: Frontier/5.1.2 (WinNT)
Host: betty.userland.com
Content-Type: text/xml
Content-length: 181

<span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;methodCall&gt;</span>
   <span class="nt">&lt;methodName&gt;</span>examples.getStateName<span class="nt">&lt;/methodName&gt;</span>
   <span class="nt">&lt;params&gt;</span>
      <span class="nt">&lt;param&gt;</span>
         <span class="nt">&lt;value&gt;&lt;i4&gt;</span>41<span class="nt">&lt;/i4&gt;&lt;/value&gt;</span>
      <span class="nt">&lt;/param&gt;</span>
   <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/methodCall&gt;</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="id2">
<h3><a class="toc-backref" href="#id9"> 响应消息 </a></h3>
<p> 除非有底层错误，否则响应首行永远为 <cite>200 OK</cite> 。</p>
<p><cite>Content-Type</cite> 必须指定为 <cite>text/xml</cite> 。</p>
<p><cite>Content-Length</cite> 必须指定，并且一定要等于消息体的长度。</p>
<p> 一个 XML-RPC 响应的消息体也为 XML 格式。</p>
<p> 消息体中只能有一个 <cite>&lt;methodResponse&gt;&lt;/methodResponse&gt;</cite> 。</p>
<blockquote>
<p> 如果为正确响应，则里面为 <cite>&lt;params&gt;&lt;/params&gt;</cite></p>
<p> 如果为错误响应，则里面为 <cite>&lt;fault&gt;&lt;/fault&gt;</cite></p>
</blockquote>
<ul>
<li><p class="first"> 正确响应 </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="highlight"><pre>HTTP/1.1 200 OK
Connection: close
Content-Length: 158
Content-Type: text/xml
Date: Fri, 17 Jul 1998 19:55:08 GMT
Server: UserLand Frontier/5.1.2-WinNT

<span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;methodResponse&gt;</span>
  <span class="nt">&lt;params&gt;</span>
    <span class="nt">&lt;param&gt;</span>
        <span class="nt">&lt;value&gt;&lt;string&gt;</span>South Dakota<span class="nt">&lt;/string&gt;&lt;/value&gt;</span>
    <span class="nt">&lt;/param&gt;</span>
  <span class="nt">&lt;/params&gt;</span>
<span class="nt">&lt;/methodResponse&gt;</span>
</pre></div>
</td></tr></table></li>
<li><p class="first"> 错误响应 </p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre>HTTP/1.1 200 OK
Connection: close
Content-Length: 426
Content-Type: text/xml
Date: Fri, 17 Jul 1998 19:55:02 GMT
Server: UserLand Frontier/5.1.2-WinNT

<span class="cp">&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="nt">&lt;methodResponse&gt;</span>
  <span class="nt">&lt;fault&gt;</span>
    <span class="nt">&lt;value&gt;</span>
      <span class="nt">&lt;struct&gt;</span>
        <span class="nt">&lt;member&gt;</span>
          <span class="nt">&lt;name&gt;</span>faultCode<span class="nt">&lt;/name&gt;</span>
          <span class="nt">&lt;value&gt;&lt;int&gt;</span>4<span class="nt">&lt;/int&gt;&lt;/value&gt;</span>
        <span class="nt">&lt;/member&gt;</span>
        <span class="nt">&lt;member&gt;</span>
          <span class="nt">&lt;name&gt;</span>faultString<span class="nt">&lt;/name&gt;</span>
          <span class="nt">&lt;value&gt;&lt;string&gt;</span>Too many parameters.<span class="nt">&lt;/string&gt;&lt;/value&gt;</span>
        <span class="nt">&lt;/member&gt;</span>
      <span class="nt">&lt;/struct&gt;</span>
    <span class="nt">&lt;/value&gt;</span>
  <span class="nt">&lt;/fault&gt;</span>
<span class="nt">&lt;/methodResponse&gt;</span>
</pre></div>
</td></tr></table></li>
</ul>
</div>
</div>
<div class="section" id="id3">
<h2><a class="toc-backref" href="#id10"> 简介 </a></h2>
<p> 本模块提供的 <cite>XML-RPC Server</cite> 基本有以下几种使用方法。</p>
<ol class="arabic">
<li><p class="first"> 使用函数来注册 RPC 方法。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">server</span> <span class="o">=</span> <span class="n">SimpleXMLRPCServer</span><span class="p">((</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="nb">pow</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></li>
<li><p class="first"> 使用一个实例来注册 RPC 方法，该实例的所有可调用属性（方法）都会被注册为 RPC 方法。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyFuncs</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">string</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="n">string</span>
    <span class="k">def</span> <span class="nf">_listMethods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">list_public_methods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> \
                <span class="p">[</span><span class="s">&#39;string.&#39;</span> <span class="o">+</span> <span class="n">method</span> <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">list_public_methods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">string</span><span class="p">)]</span>
    <span class="k">def</span> <span class="nf">pow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span> <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="p">:</span> <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">SimpleXMLRPCServer</span><span class="p">((</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_introspection_functions</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_instance</span><span class="p">(</span><span class="n">MyFuncs</span><span class="p">())</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></li>
<li><p class="first"> 使用一个拥有定制化分发方法的实例来注册 RPC 方法，由于该实例自己实现了 RPC 方法分发机制，所以 RPC 方法的注册由该实例来决定。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Math</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">_listMethods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;pow&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">_methodHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;add(2,3) =&gt; 5&quot;</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;pow&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;pow(x, y[, z]) =&gt; number&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;pow&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">pow</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s">&#39;bad method&#39;</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">SimpleXMLRPCServer</span><span class="p">((</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_introspection_functions</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_instance</span><span class="p">(</span><span class="n">Math</span><span class="p">())</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></li>
<li><p class="first"> 继承 <cite>SimpleXMLRPCServer</cite> 来实现自己的 <cite>XML-RPC Server</cite> ，需要重载 <cite>_dispatch</cite> 方法来实现自己 RPC 方法分发机制。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MathServer</span><span class="p">(</span><span class="n">SimpleXMLRPCServer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># We are forcing the &#39;export_&#39; prefix on methods that are</span>
            <span class="c"># callable through XML-RPC to prevent potential security</span>
            <span class="c"># problems</span>
            <span class="n">func</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;export_&#39;</span> <span class="o">+</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;method &quot;</span><span class="si">%s</span><span class="s">&quot; is not supported&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">export_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">MathServer</span><span class="p">((</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
<span class="n">server</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre></div>
</td></tr></table></li>
<li><p class="first"> 使用 CGI 脚本来提供 RPC 方法的注册与分发功能 :</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="n">server</span> <span class="o">=</span> <span class="n">CGIXMLRPCRequestHandler</span><span class="p">()</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="nb">pow</span><span class="p">)</span>
<span class="n">server</span><span class="o">.</span><span class="n">handle_request</span><span class="p">()</span>
</pre></div>
</td></tr></table></li>
</ol>
</div>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id11"> 辅助函数 </a></h2>
<div class="section" id="resolve-dotted-attribute">
<h3><a class="toc-backref" href="#id12">resolve_dotted_attribute</a></h3>
<p> 获取某对象的属性。比如：</p>
<pre class="literal-block">
resolve_dotted_attribute(a, 'b.c.d') =&gt; a.b.c.d
</pre>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">resolve_dotted_attribute</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">allow_dotted_names</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">allow_dotted_names</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="n">attr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">attrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">attr</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s">&#39;attempt to access private attribute &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="n">i</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">obj</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="list-public-methods">
<h3><a class="toc-backref" href="#id13">list_public_methods</a></h3>
<p> 列出某个对象所有 <em> 公共的 </em> 且 <em> 可调用的 </em> 属性（方法）。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">list_public_methods</span><span class="p">(</span><span class="n">obj</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">member</span> <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">member</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="nb">hasattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">member</span><span class="p">),</span> <span class="s">&#39;__call__&#39;</span><span class="p">)]</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="remove-duplicates">
<h3><a class="toc-backref" href="#id14">remove_duplicates</a></h3>
<p> 去除列表中的重复元素。比如：</p>
<pre class="literal-block">
[2,2,2,1,3,3] =&gt; [3,1,2]
</pre>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">lst</span><span class="p">:</span>
        <span class="n">u</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">u</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</td></tr></table><p> 代码中利用了字典中的 Key 的唯一性的特点来完成重复元素的过滤。</p>
<p> 在支持 <cite>set</cite> （集合）数据结构的 Python 版本中，可以这样写。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">remove_duplicates</span><span class="p">(</span><span class="n">lst</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">lst</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="simplexmlrpcdispatcher">
<h2><a class="toc-backref" href="#id15">SimpleXMLRPCDispatcher</a></h2>
<p><cite>SimpleXMLRPCDispatcher</cite> 以 MixIn 的形式来提供 RPC 方法的注册与分发功能。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SimpleXMLRPCDispatcher</span><span class="p">:</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># 经过注册的 RPC 方法映射关系：{ 方法名 : 方法对象 }</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="bp">None</span> <span class="c"># 经过注册的实例（其方法都会被当作为 RPC 方法）</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>

    <span class="k">def</span> <span class="nf">register_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">allow_dotted_names</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 注册一个实例，该实例的所有方法都会被当作 RPC 方法 </span>

<span class="sd">        .. warning::</span>

<span class="sd">           使用 `allow_dotted_names` 参数可能会导致安全问题，</span>

<span class="sd">           调用者可以访问到实例所在模块的全局变量，甚至可以执行任意代码。</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_dotted_names</span> <span class="o">=</span> <span class="n">allow_dotted_names</span>

    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 将一个函数注册为 RPC 方法 &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">function</span>

    <span class="k">def</span> <span class="nf">register_introspection_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 注册 RPC 内省方法 </span>
<span class="sd">        1. system.listMethods</span>
<span class="sd">        2. system.methodHelp</span>
<span class="sd">        3. system.methodSignature</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;system.listMethods&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_listMethods</span><span class="p">,</span>
                      <span class="s">&#39;system.methodSignature&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_methodSignature</span><span class="p">,</span>
                      <span class="s">&#39;system.methodHelp&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_methodHelp</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">register_multicall_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 注册 RPC 多调方法 </span>
<span class="sd">        使用该方法，可以一次提交多个需要执行的 RPC 方法，然后服务端一次将所有结果返回 </span>
<span class="sd">        这样主要为了减少请求响应次数 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s">&#39;system.multicall&#39;</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_multicall</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">_marshaled_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dispatch_method</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 反序列化客户端的请求消息体，获取其中的方法名及参数，并调用注册的对应的 PRC 方法 &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c"># 具体的反序列化操作是由 `xmlrpclib` 模块来完成的，其实就是解析请求消息中的 XML，</span>
            <span class="c"># 获取其中的方法名及参数 </span>
            <span class="n">params</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">dispatch_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">dispatch_method</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="p">(</span><span class="n">response</span><span class="p">,)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">methodresponse</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                       <span class="n">allow_none</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">Fault</span><span class="p">,</span> <span class="n">fault</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">fault</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">,</span>
                                       <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># report exception back to server</span>
            <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">Fault</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)),</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">def</span> <span class="nf">system_listMethods</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 列出服务端提供的所有 RPC 方法 &quot;&quot;&quot;</span>
        <span class="n">methods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#39;_listMethods&#39;</span><span class="p">):</span>
                <span class="n">methods</span> <span class="o">=</span> <span class="n">remove_duplicates</span><span class="p">(</span>
                        <span class="n">methods</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">_listMethods</span><span class="p">()</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#39;_dispatch&#39;</span><span class="p">):</span>
                <span class="n">methods</span> <span class="o">=</span> <span class="n">remove_duplicates</span><span class="p">(</span>
                        <span class="n">methods</span> <span class="o">+</span> <span class="n">list_public_methods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span>
                    <span class="p">)</span>
        <span class="n">methods</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">methods</span>

    <span class="k">def</span> <span class="nf">system_methodSignature</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 返回函数名对应函数的签名（参数类型列表）</span>
<span class="sd">        但由于 Python 函数的参数不需要指定其类型，所以函数签名功能也无法实现 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="s">&#39;signatures not supported&#39;</span>

    <span class="k">def</span> <span class="nf">system_methodHelp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 返回 RPC 方法的帮助文档 (docstring)&quot;&quot;&quot;</span>
        <span class="n">method</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">method_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="n">method_name</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#39;_methodHelp&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">_methodHelp</span><span class="p">(</span><span class="n">method_name</span><span class="p">)</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#39;_dispatch&#39;</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="n">resolve_dotted_attribute</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
                                <span class="n">method_name</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">allow_dotted_names</span>
                                <span class="p">)</span>
                <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">import</span> <span class="nn">pydoc</span>
            <span class="k">return</span> <span class="n">pydoc</span><span class="o">.</span><span class="n">getdoc</span><span class="p">(</span><span class="n">method</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">system_multicall</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;system.multicall([{&#39;methodName&#39;: &#39;add&#39;, &#39;params&#39;: [2, 2]}, ...]) =&gt; [[4], ...]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">call_list</span><span class="p">:</span>
            <span class="n">method_name</span> <span class="o">=</span> <span class="n">call</span><span class="p">[</span><span class="s">&#39;methodName&#39;</span><span class="p">]</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">call</span><span class="p">[</span><span class="s">&#39;params&#39;</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">(</span><span class="n">method_name</span><span class="p">,</span> <span class="n">params</span><span class="p">)])</span>
            <span class="k">except</span> <span class="n">Fault</span><span class="p">,</span> <span class="n">fault</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s">&#39;faultCode&#39;</span> <span class="p">:</span> <span class="n">fault</span><span class="o">.</span><span class="n">faultCode</span><span class="p">,</span>
                     <span class="s">&#39;faultString&#39;</span> <span class="p">:</span> <span class="n">fault</span><span class="o">.</span><span class="n">faultString</span><span class="p">}</span>
                    <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_tb</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s">&#39;faultCode&#39;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="s">&#39;faultString&#39;</span> <span class="p">:</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)}</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">results</span>

    <span class="k">def</span> <span class="nf">_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 分发 RPC 方法，本质就是根据传入的方法名及参数来调用内部已注册的 RPC 方法 </span>

<span class="sd">        .. note::</span>

<span class="sd">           如果同时注册了函数和实例，那么函数的优先级比实例中的方法高 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">funcs</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span> <span class="s">&#39;_dispatch&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">_dispatch</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">func</span> <span class="o">=</span> <span class="n">resolve_dotted_attribute</span><span class="p">(</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">instance</span><span class="p">,</span>
                            <span class="n">method</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">allow_dotted_names</span>
                            <span class="p">)</span>
                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
                        <span class="k">pass</span>

        <span class="k">if</span> <span class="n">func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;method &quot;</span><span class="si">%s</span><span class="s">&quot; is not supported&#39;</span> <span class="o">%</span> <span class="n">method</span><span class="p">)</span>
</pre></div>
</td></tr></table><div class="section" id="register-introspection-functions">
<h3><a class="toc-backref" href="#id16">register_introspection_functions</a></h3>
<p>XML-RPC 的内省协议并不是 XML-RPC 标准的一部分，不过大多数 XML-RPC 的客户端及服务端都实现该内省协议。</p>
<p> 详情可参见 <a class="reference external" href="http://xmlrpc-c.sourceforge.net/introspection.html">XML-RPC Introspection</a></p>
</div>
<div class="section" id="allow-dotted-names">
<h3><a class="toc-backref" href="#id17">allow_dotted_names</a></h3>
<p> 在上面的注释中有提到，如果打开该参数，会允许调用者访问实例所在模块的所有变量，甚至执行任意代码。</p>
<p> 那么调用者是如何做到的呢？</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MyFuncs</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">x</span> <span class="o">//</span> <span class="n">y</span>

<span class="n">server</span> <span class="o">=</span> <span class="n">SimpleXMLRPCServer</span><span class="p">((</span><span class="s">&quot;localhost&quot;</span><span class="p">,</span> <span class="mi">8000</span><span class="p">))</span>
<span class="n">server</span><span class="o">.</span><span class="n">register_instance</span><span class="p">(</span><span class="n">MyFuncs</span><span class="p">())</span>
</pre></div>
</td></tr></table><p> 以上面的代码为例：</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">MyFuncs</span><span class="o">.</span><span class="n">div</span><span class="o">.</span><span class="n">im_func</span><span class="o">.</span><span class="n">func_globals</span>
</pre></div>
</td></tr></table><p> 运行上面的代码（输出太多，我这里就不贴出来了），你会看到 <cite>MyFuncs</cite> 所在模块的所有全局变量都能够访问。</p>
<p> 如果你在模块导入了 <cite>os</cite> 、 <cite>command</cite> 、 <cite>subprocess</cite> 等模块，那么调用者就能调用任意命令了。</p>
<p> 想深入了解，参见 <a class="reference external" href="http://stackoverflow.com/questions/15462016/injecting-arbitrary-code-into-a-python-simplexmlrpc-server">Injecting arbitrary code into a Python SimpleXMLRPC Server</a></p>
<p> 如果非要用 <cite>allow_dotted_names</cite> ，也是有解决办法的。</p>
<pre class="literal-block">
在 `MyFuncs` 中定义  `_dispatch` 方法，实现自己的 RPC 方法分发。
</pre>
</div>
</div>
<div class="section" id="simplexmlrpcrequesthandler">
<h2><a class="toc-backref" href="#id18">SimpleXMLRPCRequestHandler</a></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SimpleXMLRPCRequestHandler</span><span class="p">(</span><span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="p">):</span>
    <span class="c"># RPC 路径上面在简介 XML-RPC 时就提到过 </span>
    <span class="n">rpc_paths</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="s">&#39;/RPC2&#39;</span><span class="p">)</span>

    <span class="c"># 响应数据的最大传输单元，如果原始响应数据超过该值，则尝试用 GZIP 进行压缩 </span>
    <span class="n">encode_threshold</span> <span class="o">=</span> <span class="mi">1400</span> <span class="c">#a common MTU</span>

    <span class="c"># Nagle 算法会让数据发送延时，对于 RPC 这种实时应用，需要禁用它。</span>
    <span class="c"># 但是一旦禁用 Nagle 算法，任何大小的数据包就会立即发送，</span>
    <span class="c"># 这样就需要上层来控制每次尽量发送尽可能多的数据包 </span>
    <span class="c"># 其实就是关闭底层的 Nagle 算法，然后上层自己完成 Nagle 算法的类似功能。</span>
    <span class="n">wbufsize</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">disable_nagle_algorithm</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="c"># a re to match a gzip Accept-Encoding</span>
    <span class="n">aepattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">                            \s* ([^\s;]+) \s*            #content-coding</span>
<span class="s">                            (;\s* q \s*=\s* ([0-9\.]+))? #q</span>
<span class="s">                            &quot;&quot;&quot;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">VERBOSE</span> <span class="o">|</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">accept_encodings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">ae</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;Accept-Encoding&quot;</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">ae</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&quot;,&quot;</span><span class="p">):</span>
            <span class="n">match</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aepattern</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                <span class="n">v</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="k">else</span> <span class="mf">1.0</span>
                <span class="n">r</span><span class="p">[</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">return</span> <span class="n">r</span>

    <span class="k">def</span> <span class="nf">is_rpc_path_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 验证 RPC 路径 &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_paths</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rpc_paths</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">do_POST</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 所有的 XML-PRC 都是 POST 请求 &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rpc_path_valid</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">report_404</span><span class="p">()</span>
            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c"># 这里为何要多次读取，请参见下面的 `Issue792570`</span>
            <span class="n">max_chunk_size</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="mi">1024</span><span class="o">*</span><span class="mi">1024</span>
            <span class="n">size_remaining</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s">&quot;content-length&quot;</span><span class="p">])</span>
            <span class="n">L</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">while</span> <span class="n">size_remaining</span><span class="p">:</span>
                <span class="n">chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">size_remaining</span><span class="p">,</span> <span class="n">max_chunk_size</span><span class="p">)</span>
                <span class="n">chunk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rfile</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">chunk_size</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
                <span class="n">size_remaining</span> <span class="o">-=</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode_request_content</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="c">#response has been sent</span>

            <span class="c"># getattr(self, &#39;_dispatch&#39;, None)</span>
            <span class="c"># 是为了兼容以前的版本，以前的版本的分发方法 `_dispatch` 是在本类中的。</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_marshaled_dispatch</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_dispatch&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span> <span class="c"># This should only happen if the module is buggy</span>
            <span class="c"># internal error, report as HTTP server error</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>

            <span class="c"># Send information about the exception if requested</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="p">,</span> <span class="s">&#39;_send_traceback_header&#39;</span><span class="p">)</span> <span class="ow">and</span> \
                    <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">_send_traceback_header</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;X-exception&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;X-traceback&quot;</span><span class="p">,</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># 如果返回的数据太大，则尝试进行 GZIP 压缩 </span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">200</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s">&quot;text/xml&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">encode_threshold</span><span class="p">:</span>
                    <span class="n">q</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept_encodings</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">q</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">response</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">gzip_encode</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-Encoding&quot;</span><span class="p">,</span> <span class="s">&quot;gzip&quot;</span><span class="p">)</span>
                        <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                            <span class="k">pass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">decode_request_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 解码 GZIP 格式的请求消息，具体参见下面的 `HTTP 压缩 ` &quot;&quot;&quot;</span>
        <span class="n">encoding</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;content-encoding&quot;</span><span class="p">,</span> <span class="s">&quot;identity&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s">&quot;identity&quot;</span><span class="p">:</span> <span class="c"># 原始数据，未经过压缩 </span>
            <span class="k">return</span> <span class="n">data</span>
        <span class="k">if</span> <span class="n">encoding</span> <span class="o">==</span> <span class="s">&quot;gzip&quot;</span><span class="p">:</span> <span class="c"># 经过 GZIP 格式压缩的数据 </span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">gzip_decode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">NotImplementedError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">501</span><span class="p">,</span> <span class="s">&quot;encoding </span><span class="si">%r</span><span class="s"> not supported&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s">&quot;error decoding gzip content&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">501</span><span class="p">,</span> <span class="s">&quot;encoding </span><span class="si">%r</span><span class="s"> not supported&quot;</span> <span class="o">%</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">report_404</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_response</span><span class="p">(</span><span class="mi">404</span><span class="p">)</span>
        <span class="n">response</span> <span class="o">=</span> <span class="s">&#39;No such page&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s">&quot;text/plain&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">send_header</span><span class="p">(</span><span class="s">&quot;Content-length&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">end_headers</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wfile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">log_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s">&#39;-&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">logRequests</span><span class="p">:</span>
            <span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="o">.</span><span class="n">log_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</pre></div>
</td></tr></table><div class="section" id="mtu">
<h3><a class="toc-backref" href="#id19">MTU</a></h3>
<p> 通信术语： 最大传输单元（Maximum Transmission Unit，MTU）</p>
<blockquote>
指一种通信协议的某一层上面一次传输所能通过的最大数据包大小（以字节为单位）</blockquote>
<p> 上面的 <cite>encode_threshold</cite> 设置为 <cite>1400</cite> ，算是 TCP 协议中的常用值。</p>
<p> 代码中使用 <cite>encode_threshold</cite> 主要是为了压缩响应数据的长度，尽量使用较少的传输数次数将响应数据发送给客户端。</p>
</div>
<div class="section" id="issue792570">
<h3><a class="toc-backref" href="#id20">Issue792570</a></h3>
<p> 该 Bug 产生的原因是服务端的 socket 在进行 read 操作时，如果一次性读取大量的数据，有可能会导致读取的数据不完整，导致后面进行 XML 解析时失败。</p>
<p> 详情参见 <a class="reference external" href="http://bugs.python.org/issue792570">SimpleXMLRPCServer cannot handle large requests</a></p>
</div>
<div class="section" id="http">
<h3><a class="toc-backref" href="#id21">HTTP 压缩 </a></h3>
<p>HTTP 压缩是在 Web 服务器和浏览器间传输压缩文本内容的方法，主要为了更加有效节约带宽流量。当然，它的代价就是增加了服务器的一些 CPU 开销。</p>
<p> 其实 HTTP 压缩本质上来说是 HTTP 内容编码的子集。</p>
<p>HTTP 内容编码定义了一些标准的内容编码类型，并允许用扩展编码的形式添加更多的编码。</p>
<p><cite>Content-Encoding</cite> 就是用标准化的代号来说明编码时所用到的算法。</p>
<p>HTTP 压缩采用的常用标准化代码如下：</p>
<ol class="arabic simple">
<li>gzip 消息体内容用 gzip 数据流进行封装 </li>
<li>compress 消息体内容用 compress 数据流进行封装 </li>
<li>deflate 消息体内容是原始格式、没有数据头的 DEFLATE 数据流 </li>
<li>identity 表明没有对消息体内容进行编码，当没有 <cite>Content-Encoding</cite> 头部时，本情况为默认值 </li>
</ol>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p> 虽说 HTTP/1.1 版本才正式规定了 <cite>HTTP 压缩 </cite> ，但是在实际应用中，</p>
<p> 服务端一般不根据 HTTP 版本号，而是根据请求消息头部中的 <cite>Accept-Encoding</cite> 值 </p>
<p class="last"> 来判定客户端支持哪些压缩格式的。</p>
</div>
</div>
</div>
<div class="section" id="id5">
<h2><a class="toc-backref" href="#id22">SimpleXMLRPCServer</a></h2>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">SimpleXMLRPCServer</span><span class="p">(</span><span class="n">SocketServer</span><span class="o">.</span><span class="n">TCPServer</span><span class="p">,</span>
                         <span class="n">SimpleXMLRPCDispatcher</span><span class="p">):</span>

    <span class="n">allow_reuse_address</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="n">_send_traceback_header</span> <span class="o">=</span> <span class="bp">False</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">requestHandler</span><span class="o">=</span><span class="n">SimpleXMLRPCRequestHandler</span><span class="p">,</span>
                 <span class="n">logRequests</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bind_and_activate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logRequests</span> <span class="o">=</span> <span class="n">logRequests</span>

        <span class="n">SimpleXMLRPCDispatcher</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_none</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>
        <span class="n">SocketServer</span><span class="o">.</span><span class="n">TCPServer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">requestHandler</span><span class="p">,</span> <span class="n">bind_and_activate</span><span class="p">)</span>

        <span class="c"># 参见下面的 `Issue1222790`</span>
        <span class="k">if</span> <span class="n">fcntl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">fcntl</span><span class="p">,</span> <span class="s">&#39;FD_CLOEXEC&#39;</span><span class="p">):</span>
            <span class="n">flags</span> <span class="o">=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_GETFD</span><span class="p">)</span>
            <span class="n">flags</span> <span class="o">|=</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">FD_CLOEXEC</span>
            <span class="n">fcntl</span><span class="o">.</span><span class="n">fcntl</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">F_SETFD</span><span class="p">,</span> <span class="n">flags</span><span class="p">)</span>
</pre></div>
</td></tr></table><div class="section" id="send-traceback-header">
<h3><a class="toc-backref" href="#id23">_send_traceback_header</a></h3>
<p> 调试参数。如果该参数为 True，XML-RPC 在处理请求消息的解析及 RPC 方法分发时发生异常，响应消息头部就会带上异常栈信息。</p>
<div class="warning">
<p class="first admonition-title">Warning</p>
<p class="last"> 该参数只能用于调试环境，当用于生产环境时，必须关闭。不然有可能暴露内部的代码实现。</p>
</div>
</div>
<div class="section" id="issue1222790">
<h3><a class="toc-backref" href="#id24">Issue1222790</a></h3>
<p> 该 Bug 描述的情况是，服务端提供的 RPC 方法中有可能调用（linux: fork+exec）外部程序，那么该外部程序就会继承服务端打开的 socket 句柄（fork 函数的功能），如果此时服务端在该外部程序退出之前就退出了，外部程序就会占用该 socket 句柄（该句柄绑定的 IP：PORT 也就会一直被占用），服务端进程再次拉起时，会尝试绑定原来的 IP：PORT，但由于其被占用，服务端就会报错误 <cite>Address already in use</cite> ，无法正常工作。</p>
<p> 那么对该 socket 句柄设置了 <cite>FD_CLOEXEC</cite> 标志后，在 fork 出来的子进程里执行 exec 来调用外部程序时，就会自动关闭该 socket 句柄，外部程序就会不占用服务端绑定的 IP：PORT。</p>
<p> 详情参见 <a class="reference external" href="http://bugs.python.org/issue1222790">SimpleXMLRPCServer does not set FD_CLOEXEC</a></p>
</div>
</div>
<div class="section" id="multipathxmlrpcserver">
<h2><a class="toc-backref" href="#id25">MultiPathXMLRPCServer</a></h2>
<p> 多路分发 XML-RPC 服务 </p>
<p> 它和 <cite>SimpleXMLRPCServer</cite> 的区别在于，它支持注册多个 Dispatcher 实例并同时提供 XML-RPC 服务，多个实例之间互不冲突（绑定的 URL 路径不同，当然不会冲突）。</p>
<p>Dispatcher 一般指的是 <cite>SimpleXMLRPCDispatcher</cite> 或者是基于 <cite>SimpleXMLRPCDispatcher</cite> 的类。</p>
<div class="tip">
<p class="first admonition-title">Tip</p>
<p class="last"> 该类在 Python 官方文档里未介绍，网上提及到该类的博文也很少，怪哉。</p>
</div>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MultiPathXMLRPCServer</span><span class="p">(</span><span class="n">SimpleXMLRPCServer</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">requestHandler</span><span class="o">=</span><span class="n">SimpleXMLRPCRequestHandler</span><span class="p">,</span>
                 <span class="n">logRequests</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bind_and_activate</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>

        <span class="n">SimpleXMLRPCServer</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">addr</span><span class="p">,</span> <span class="n">requestHandler</span><span class="p">,</span> <span class="n">logRequests</span><span class="p">,</span> <span class="n">allow_none</span><span class="p">,</span>
                                    <span class="n">encoding</span><span class="p">,</span> <span class="n">bind_and_activate</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatchers</span> <span class="o">=</span> <span class="p">{}</span> <span class="c"># 该字典维护了多个 Dispatcher 实例 </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">encoding</span> <span class="o">=</span> <span class="n">encoding</span>

    <span class="k">def</span> <span class="nf">add_dispatcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">dispatcher</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dispatchers</span><span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">=</span> <span class="n">dispatcher</span>
        <span class="k">return</span> <span class="n">dispatcher</span>

    <span class="k">def</span> <span class="nf">get_dispatcher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatchers</span><span class="p">[</span><span class="n">path</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_marshaled_dispatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">dispatch_method</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatchers</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="o">.</span><span class="n">_marshaled_dispatch</span><span class="p">(</span>
               <span class="n">data</span><span class="p">,</span> <span class="n">dispatch_method</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># report low level exception back to server</span>
            <span class="c"># (each dispatcher should have handled their own</span>
            <span class="c"># exceptions)</span>
            <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="n">xmlrpclib</span><span class="o">.</span><span class="n">Fault</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">&quot;</span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">)),</span>
                <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">allow_none</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">response</span>
</pre></div>
</td></tr></table></div>
<div class="section" id="cgixmlrpcrequesthandler">
<h2><a class="toc-backref" href="#id26">CGIXMLRPCRequestHandler</a></h2>
<p> 通过 CGI 的形式来进行提供 XML-RPC 服务。</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">CGIXMLRPCRequestHandler</span><span class="p">(</span><span class="n">SimpleXMLRPCDispatcher</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Simple handler for XML-RPC data passed through CGI.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_none</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="n">SimpleXMLRPCDispatcher</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">allow_none</span><span class="p">,</span> <span class="n">encoding</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_xmlrpc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_text</span><span class="p">):</span>
        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_marshaled_dispatch</span><span class="p">(</span><span class="n">request_text</span><span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;Content-Type: text/xml&#39;</span>
        <span class="k">print</span> <span class="s">&#39;Content-Length: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">print</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 在博文开关就说明了 XML-RCP 只使用 POST 方法，</span>
<span class="sd">        所以如果使用 GET 方法调用 CGI 脚本，就返回 400 错误 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">code</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="n">message</span><span class="p">,</span> <span class="n">explain</span> <span class="o">=</span> \

        <span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">BaseHTTPRequestHandler</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="n">code</span><span class="p">]</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">DEFAULT_ERROR_MESSAGE</span> <span class="o">%</span> \
            <span class="p">{</span>
             <span class="s">&#39;code&#39;</span> <span class="p">:</span> <span class="n">code</span><span class="p">,</span>
             <span class="s">&#39;message&#39;</span> <span class="p">:</span> <span class="n">message</span><span class="p">,</span>
             <span class="s">&#39;explain&#39;</span> <span class="p">:</span> <span class="n">explain</span>
            <span class="p">}</span>
        <span class="k">print</span> <span class="s">&#39;Status: </span><span class="si">%d</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="k">print</span> <span class="s">&#39;Content-Type: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">BaseHTTPServer</span><span class="o">.</span><span class="n">DEFAULT_ERROR_CONTENT_TYPE</span>
        <span class="k">print</span> <span class="s">&#39;Content-Length: </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
        <span class="k">print</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_text</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; 入口方法，</span>

<span class="sd">        * 默认从标准输入读入请求消息中的 XML 格式数据 </span>

<span class="sd">        * 也支持从函数的参数传入请求消息中的 XML 格式数据 </span>

<span class="sd">        然后对该数据进行解析，取出其中的方法名和参数，并进行 RPC 方法的分发 </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request_text</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> \
            <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;REQUEST_METHOD&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;GET&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_get</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># POST data is normally available through stdin</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;CONTENT_LENGTH&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
                <span class="n">length</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">request_text</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">request_text</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">length</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">handle_xmlrpc</span><span class="p">(</span><span class="n">request_text</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>

            
            <section>
<div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://chenjiee815.github.io/simplexmlrpcserverbiao-zhun-ku-yuan-ma-xue-xi.html#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
                    <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'chenjiee815blog';
        var disqus_identifier = 'http://chenjiee815.github.io/simplexmlrpcserverbiao-zhun-ku-yuan-ma-xue-xi.html';
    var disqus_url = 'http://chenjiee815.github.io/simplexmlrpcserverbiao-zhun-ku-yuan-ma-xue-xi.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

                </div>
            </div>
        </div>
    </div>
</div>
</section>

            <hr/>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2014-12-08T19:44:54.008779">Dec 8, 2014</time>
            <h4>Category</h4>
            <a class="category-link" href="http://chenjiee815.github.io/categories.html#python-ref">Python</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="http://chenjiee815.github.io/tags.html#python-ref">python
                    <span>23</span>
</a></li>
                <li><a href="http://chenjiee815.github.io/tags.html#stdlibs-ref">stdlibs
                    <span>15</span>
</a></li>
            </ul>
<h4>Contact</h4>
    <a href="http://www.htdp.org/" title="My HTDP Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-htdp sidebar-social-links"></i></a>
    <a href="http://mitpress.mit.edu/sicp/" title="My SICP Profile" class="sidebar-social-links" target="_blank">
    <i class="fa fa-sicp sidebar-social-links"></i></a>
        </div>
        </section>
</div>
</article>

                </div>
                <div class="span1"></div>
            </div>
        </div>
        <div id="push"></div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

            <script type="text/javascript">
var disqus_shortname = 'chenjiee815blog';
(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>
<script  language="javascript" type="text/javascript">
function uncollapse() {
    if (window.location.hash.match(/^#comment-\d+$/)) {
        $('#disqus_thread').collapse('show');
    }
}
</script>
<script type="text/javascript" language="JavaScript">
uncollapse();
window.onhashchange=function(){
    if (window.location.hash.match(/^#comment-\d+$/))
        window.location.reload(true);
}
</script>
<script>
$('#disqus_thread').on('shown', function () {
    var link = document.getElementsByClassName('accordion-toggle');
    var old_innerHTML = link[0].innerHTML;
    $(link[0]).fadeOut(500, function() {
        $(this).text('Click here to hide comments').fadeIn(500);
    });
    $('#disqus_thread').on('hidden', function () {
        $(link[0]).fadeOut(500, function() {
            $(this).text(old_innerHTML).fadeIn(500);
        });
    })
})
</script>


    </body>
    <!-- Theme: Elegant built for Pelican
    License : http://oncrashreboot.com/pelican-elegant -->
</html>